Define VPN_APP_ROOT /vpn-user-portal

SetEnv VPN_APP_ROOT ${VPN_APP_ROOT}

# fancy URLs for the OAuth/API calls
Alias ${VPN_APP_ROOT}/oauth/authorize /usr/share/vpn-user-portal/web/index.php
Alias ${VPN_APP_ROOT}/oauth/token     /usr/share/vpn-user-portal/web/oauth.php
Alias ${VPN_APP_ROOT}/api             /usr/share/vpn-user-portal/web/api.php

Alias ${VPN_APP_ROOT} /usr/share/vpn-user-portal/web
Alias /.well-known/vpn-user-portal /usr/share/vpn-user-portal/web/well-known.php

<Directory /usr/share/vpn-user-portal/web>
    Require all granted
    #Require local

    RewriteEngine on
    RewriteBase ${VPN_APP_ROOT}
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^ index.php [L,QSA]

    <Files index.php>
        # Security Headers
        # https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/img-src
        # mentions that img-src data: is insecure, but fails to provide details...
        Header always set Content-Security-Policy "default-src 'self'; img-src 'self' data:"
        Header always set X-Frame-Options "DENY"
        Header always set X-Content-Type-Options "nosniff"
        Header always set X-XSS-Protection "1; mode=block"
        Header always set Referrer-Policy "same-origin"
    </Files>

    <Files node-api.php>
        <RequireAny>
            Require local
            # When using separate VPN node(s) running (vpn-server-node),
            # add the IP address(es) of the node(s) here
            #Require ip 192.0.2.0/24
            #Require ip 2001:db::/32
        </RequireAny>
    </Files>
</Directory>
